<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>Raju IT</title>
        <link href="css/styles.css" rel="stylesheet" />
        <link href="css/login.css" rel="stylesheet" />
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand" href="index.html"><img src="assets/img/navbar-logo.svg" alt="..." /></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars ms-1"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                  <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#products">Products</a></li>
                    <li class="nav-item" id="authContainer">
                      <a class="nav-link" href="#" id="navLoginBtn" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a>
                    </li>
                  </ul>
                </div>
            </div>
        </nav>
        
        <!-- Masthead-->
        <header class="masthead">
            <div class="container">
                <div class="masthead-subheading">Welcome To Our Shop!</div>
                <div class="masthead-heading text-uppercase">It's Nice To Meet You</div>
                <a class="btn btn-primary btn-xl text-uppercase" href="#products">Buy Products</a>
            </div>
        </header>
        
        <!-- Products Grid-->
        <section class="page-section bg-light" id="products">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Products</h2>
                    <h3 class="section-subheading text-muted">Discover our latest trendy outfits for ladies and gents</h3>
                </div>
                <div class="row">
                    <div class="col-lg-4 col-sm-6 mb-4">
                        <div class="products-item">
                            <a class="products-link" data-bs-toggle="modal" href="#productsModal1">
                                <div class="products-hover">
                                    <div class="products-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                                </div>
                                <img class="img-fluid" src="assets/img/products/1.jpg" alt="..." />
                            </a>
                            <div class="products-caption">
                                <div class="products-caption-heading">Threads</div>
                                <div class="products-caption-subheading text-muted">Illustration</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- About-->
        <section class="page-section" id="about">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">About Us</h2>
                    <h3 class="section-subheading text-muted">RajuIt is the online shopping website for ladies & gents</h3>
                </div>
                <ul class="timeline">
                    <li>
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="assets/img/about/1.jpg" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>2009-2011</h4>
                                <h4 class="subheading">Our Humble Beginnings</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">We started our journey with a simple vision â€” to offer trendy, comfortable, and affordable fashion for both ladies and gents. Today, we continue to grow with your love and support, delivering quality styles for every occasion.</p></div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="assets/img/about/2.jpg" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>March 2011</h4>
                                <h4 class="subheading">Our brand was Born</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">Our brand started with a passion for fashion and a mission to deliver quality clothing for both women and men. Today, we continue to grow with the love and trust of our customers.</p></div>
                        </div>
                    </li>
                    <li>
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="assets/img/about/3.jpg" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>December 2015</h4>
                                <h4 class="subheading">Transition to Full Service</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">By 2015, our brand had grown stronger with the trust of our customers. We expanded from a small setup into a full-service fashion store for both ladies and gents.</p></div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image"><img class="rounded-circle img-fluid" src="assets/img/about/4.jpg" alt="..." /></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>July 2020</h4>
                                <h4 class="subheading">Phase Two Expansion</h4>
                            </div>
                            <div class="timeline-body"><p class="text-muted">In 2020, we entered a new phase of growth with a major expansion of our brand. We upgraded our collections with modern designs, trending styles, and premium-quality materials.</p></div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image">
                            <h4>
                                Be Part
                                <br />
                                Of Our
                                <br />
                                Story!
                            </h4>
                        </div>
                    </li>
                </ul>
            </div>
        </section>
        
        <!-- Contact-->
        <section class="page-section" id="contact">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Contact Us</h2>
                    <h3 class="section-subheading text-muted">For inquiries about our services, pricing, or partnerships, please fill out the form below. Our team will contact you within an hour</h3>
                </div>
                <!-- Contact Form -->
                <form id="contactForm">
                    <div class="row align-items-stretch mb-5">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <!-- Name input-->
                                <label for="contactName" class="form-label" style="color: white;">Your Name <span class="text-danger">*</span></label>
                                <input class="form-control" id="contactName" name="name" type="text" placeholder="Enter your full name" required />
                                <div class="invalid-feedback d-block" id="nameError"></div>
                            </div>
                            <div class="form-group mb-3">
                                <!-- Email address input-->
                                <label for="contactEmail" class="form-label" style="color: white;">Your Email <span class="text-danger">*</span></label>
                                <input class="form-control" id="contactEmail" name="email" type="email" placeholder="Enter your email address" required />
                                <div class="invalid-feedback d-block" id="emailError"></div>
                            </div>
                            <div class="form-group mb-md-0">
                                <!-- Phone number input-->
                                <label for="contactPhone" class="form-label" style="color: white;">Your Phone <span class="text-danger">*</span></label>
                                <input class="form-control" id="contactPhone" name="phone" type="tel" placeholder="Enter your phone number" required />
                                <div class="invalid-feedback d-block" id="phoneError"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-group-textarea mb-md-0">
                                <!-- Message input-->
                                <label for="contactMessage" class="form-label" style="color: white;">Your Message <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="contactMessage" name="message" placeholder="Enter your message here..." rows="5" required></textarea>
                                <div class="invalid-feedback d-block" id="messageError"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Submit success message-->
                    <div class="alert alert-success d-none" id="submitSuccessMessage" role="alert">
                        <h4 class="alert-heading">Success!</h4>
                        <p>Your message has been sent successfully. We'll get back to you soon!</p>
                    </div>
                    
                    <!-- Submit error message-->
                    <div class="alert alert-danger d-none" id="submitErrorMessage" role="alert">
                        <h4 class="alert-heading">Error!</h4>
                        <p id="errorText">Error sending message. Please try again later.</p>
                    </div>
                    
                    <!-- Submit Button-->
                    <div class="text-center">
                        <button class="btn btn-primary btn-xl text-uppercase" id="submitButton" type="submit">
                            <span id="buttonText">Send Message</span>
                            <span id="buttonSpinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                        </button>
                    </div>
                </form>
            </div>
        </section>
        
        <!-- Footer-->
        <footer class="footer py-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-4 text-lg-start">Copyright &copy; Raju It 2025</div>
                    <div class="col-lg-4 my-3 my-lg-0">
                        <a class="btn btn-dark btn-social mx-2" href="https://www.instagram.com/rajuit1396/?igsh=MWZlOHk4bWxrY3hwMg%3D%3D&fbclid=IwY2xjawOXwtFleHRuA2FlbQIxMABicmlkETFXaXRyMnR5aWF3eHB2SVl4c3J0YwZhcHBfaWQQMjIyMDM5MTc4ODIwMDg5MgABHmKxgCF0yvOPwVkc5ovEt0JNh-K_DZ4egj27cYWVsba8m6bRIbTOszGrRkTA_aem_wyHdzWPSdl7DxeJ2So-lUw&brid=JbRWKsUzQoW71PD4MGNTnw"  aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a class="btn btn-dark btn-social mx-2" href="https://www.facebook.com/profile.php?id=61584622701133" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    </div>
                    <div class="col-lg-4 text-lg-end">
                        <a class="link-dark text-decoration-none me-3 text-white" href="privacy&policy.html">Privacy Policy</a>
                        <a class="link-dark text-decoration-none text-white" href="terms&conditions.html">Terms & Conditions</a>
                        <a class="link-dark text-decoration-none text-white" href="return&refund.html">Return & Refund Policy</a>
                        <a class="link-dark text-decoration-none text-white" href="#!">Shipping Policy</a>
                        <a class="link-dark text-decoration-none text-white" href="#!">Disclaimer</a>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Login Modal -->
        <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content login-box">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="loginModalLabel">Login</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="loginForm">
                  <div class="mb-3">
                    <label for="loginEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" name="email" id="loginEmail" placeholder="Enter your email" required>
                  </div>
                  <div class="mb-3">
                    <label for="loginPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" name="password" id="loginPassword" placeholder="Enter your password" required>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">Login</button>
                  <div class="mt-3 text-center">
                    <a href="#" class="small text-muted" data-bs-toggle="modal" data-bs-target="#forgotModal" data-bs-dismiss="modal">Forgot password?</a><br>
                    <a href="#" class="small text-muted" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Don't have an account? Create account</a>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Register Modal -->
        <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content login-box">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="registerModalLabel">Create an account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="registerForm">
                  <div class="mb-3">
                    <label for="registerName" class="form-label">Full Name</label>
                    <input type="text" class="form-control" name="name" id="registerName" placeholder="Enter your full name" required>
                  </div>
                  <div class="mb-3">
                    <label for="registerEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" name="email" id="registerEmail" placeholder="Enter your email" required>
                  </div>
                  <div class="mb-3">
                    <label for="registerPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" name="password" id="registerPassword" placeholder="Enter your password" required>
                  </div>
                  <div class="mb-3">
                    <label for="registerConfirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm your password" required>
                  </div>
                  <div class="mb-3">
                    <label for="registerPhone" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" name="phone" id="registerPhone" placeholder="Enter your phone number" required>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">Create account</button>
                  <div class="text-center mt-3">
                    <small>Already have an account? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Login</a></small>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Forgot Password Modal -->
        <div class="modal fade" id="forgotModal" tabindex="-1" aria-labelledby="forgotModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content login-box">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="forgotModalLabel">Forgot Password</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="forgotForm">
                  <div class="mb-3">
                    <label for="forgotEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="forgotEmail" placeholder="Enter your email" required>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">Send Reset Link</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/scripts.js"></script>

        <script>
(async function initAuth() {
  const authContainer = document.getElementById("authContainer");
  const navLogin = document.getElementById("navLoginBtn");
  if (!navLogin || !authContainer) return;

  function showLogin() {
    localStorage.removeItem("token");
    navLogin.innerText = "Login";
    navLogin.setAttribute("data-bs-toggle", "modal");
    navLogin.setAttribute("data-bs-target", "#loginModal");
    navLogin.removeAttribute("href");
    // Remove logout button if exists
    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) logoutBtn.remove();
  }

  function showLogout(userName) {
    navLogin.innerText = userName;
    navLogin.removeAttribute("data-bs-toggle");
    navLogin.removeAttribute("data-bs-target");
    navLogin.setAttribute("href", "/dashboard.html");
    navLogin.addEventListener("click", (e) => { 
      e.preventDefault(); 
      window.location.href = "/dashboard.html"; 
    }, { capture: true });

    // âœ… Add Logout button
    let logoutBtn = document.getElementById("logoutBtn");
    if (!logoutBtn) {
      logoutBtn = document.createElement("li");
      logoutBtn.className = "nav-item";
      logoutBtn.id = "logoutBtn";
      logoutBtn.innerHTML = '<a class="nav-link" href="/logout">Logout</a>';
      authContainer.parentElement.appendChild(logoutBtn);
    }
  }

  // Try server-side session first
  try {
    const res = await fetch("/check-login", { credentials: "include" });
    if (res.ok) {
      const data = await res.json().catch(()=>null);
      if (data && data.loggedIn) {
        const name = data.user?.name || data.user?.email || "User";
        showLogout(name);
        return;
      }
    }
  } catch (err) {
    console.debug("check-login failed", err);
  }

  // Fallback: validate local token
  const token = localStorage.getItem("token");
  if (!token) { showLogin(); return; }

  try {
    const parts = token.split('.');
    if (parts.length !== 3) throw new Error("Invalid token format");
    const decoded = JSON.parse(atob(parts[1]));
    if (decoded.exp && decoded.exp * 1000 < Date.now()) throw new Error("Token expired");

    const apiRes = await fetch("/dashboard", {
      method: "GET",
      headers: { "Authorization": `Bearer ${token}` },
      credentials: "include"
    });

    if (apiRes.ok) {
      const apiData = await apiRes.json().catch(()=>null);
      const name = apiData?.user?.name || decoded.name || decoded.email || "User";
      showLogout(name);
      return;
    } else {
      showLogin();
    }
  } catch (err) {
    console.log("Token invalid:", err.message);
    showLogin();
  }
})();

document.addEventListener("click", function (e) {
  if (e.target.getAttribute("href") === "/logout") {
    localStorage.removeItem("token");
  }
});

// âœ… Login
document.getElementById("loginForm").addEventListener("submit", async function (e) {
  e.preventDefault();
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;

  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ email, password }),
      credentials: "include"
    });
    const data = await res.json().catch(()=>null);

    if (res.ok && data?.token) {
      // âœ… Store token immediately
      localStorage.setItem("token", data.token);
      
      // âœ… Close modal and wait longer
      const modalEl = document.getElementById('loginModal');
      const modal = bootstrap.Modal.getInstance(modalEl);
      if (modal) modal.hide();
      
      // âœ… Longer delay to ensure modal closes
      setTimeout(() => {
        console.log("ðŸ”„ Redirecting to dashboard...");
        window.location.href = "/dashboard.html";
      }, 600); // Increased from 300ms to 600ms
    } else {
      alert(data?.message || "Login failed");
    }
  } catch (err) {
    console.error(err);
    alert("Network error during login");
  }
});

// âœ… Contact Form Handler - OPTIMIZED with detailed logging

        </script>
    </body>
</html>

